<div class="row">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header">
        <%= fa_icon 'calendar' %>
        <strong><%= form_title %></strong>
      </div>
      <div class="card-body">
        <%= simple_form_for(academic_calendar) do |f| %>
          <div class="row">
            <div class='form-group col-sm-12'>
              <%= f.error_notification %>
              <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
            </div>
            <div class='form-group col-sm-12'>
              <%= f.input :name %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.association :academic_term, label_method: lambda { |academic_term| full_name(academic_term) }, value_method: :id %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.association :calendar_type %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.input :senate_decision_date,
                          as: :date_time_picker,
                          input_html: { data: { class: 'senate_decision_date'} } %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.input :senate_decision_no %>
            </div>
            <div class='form-group col-sm-12'>
              <%= f.input :description %>
            </div>
          </div>
          <% if academic_calendar.persisted?  %>
            <div class='form-group col-sm-12'>
              <%= f.association :units, collection: Unit.active.where(unit_type: f.object.calendar_type.unit_type_ids),
                                        label_method: :names_depth_cache, required: true %>
            </div>
            <hr \>
            <center><h3><%= t('.events') %></h3></center>
            <div class="col-lg-12" id="calendar_events">
              <%= f.simple_fields_for :calendar_events do |event| %>
                <%= render 'calendar_event_fields', f: event %>
              <% end %>
              <br>
              <center><%= link_to_add_association t('.new_event_link'), f, :calendar_events, class: 'btn btn-outline-primary btn-sm' %></center>
            </div>
          <% end %>
          <div class='form-group col-sm-12'>
            <%= f.button :submit, class: 'btn btn-outline-success btn-sm' %>
            <%= link_to_back(:back) %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%= javascript_include_tag 'shared/cocoon' %>
<%= render 'select2' %>

<script>
  flatpickr("[data-class='senate_decision_date']", { altInput: true })
  flatpickr("[data-class='event-date']", { enableTime: true, altInput: true })

  $('#calendar_events').on('cocoon:after-insert', function(e, added_event) {
    $(added_event).find("[data-class='event-date']")
                  .flatpickr({ enableTime: true, altInput: true })
  })
</script>