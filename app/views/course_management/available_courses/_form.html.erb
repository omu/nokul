<div class='row'>
  <div class='col-sm-12'>
    <div class='card'>
      <div class='card-header'>
        <%= fa_icon 'calendar' %>
        <strong><%= form_title %></strong>
      </div>
      <div class='card-body'>
        <%= simple_form_for(@available_course) do |f| %>
          <%= f.error_notification %>
          <% if f.object.errors.any? %>
            <ul class="list-group list-group-accent">
              <% f.object.errors.full_messages.each do |message| %>
                <li class="list-group-item list-group-item-accent-danger list-group-item-danger">
                  <%= message %>
                </li>
              <% end %>
            </ul>
          <% end %>
          <div class='row mt-3'>
            <div class='form-group col-sm-6'>
              <%= label_tag(:unit_id, t('.unit')) %>
              <%= select_tag(:unit_id,
                            options_from_collection_for_select(Unit.active.coursable.order(:name), :id, :names_depth_cache, params[:unit_id]),
                            include_blank: true,
                            class: 'form-control',
                            style: 'width: 100%') %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.association :curriculum %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.association :academic_term, label_method: lambda { |academic_term| full_name(academic_term) }, required: true %>
            </div>
            <div class='form-group col-sm-6'>
              <%= f.association :course %>
            </div>
            <div class='form-group col-sm-12'>
              <%= f.button :submit, class: 'btn btn-outline-success btn-sm' %>
              <%= link_to_back(:back) %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script type='text/javascript'>
  $(document).ready(function() {
    $('#unit_id, #available_course_course_id').select2();

    var parameters = [
      {
        el: '#unit_id',
        target: '#available_course_curriculum_id',
        params: { 'unit_id': '#unit_id' },
        source: '/units/:unit_id/curriculums/',
        label_attribute: 'name',
        reset_selectors: '#available_course_curriculum_id, #available_course_course_id',
        placeholder: 'Birim Seçiniz'
      },
      {
        el: '#available_course_curriculum_id',
        target: '#available_course_course_id',
        params: { 'curriculum_id': '#available_course_curriculum_id' },
        source: '/curriculums/:curriculum_id/courses/',
        label_attribute: 'name',
        reset_selectors: '#available_course_course_id',
        placeholder: 'Müfredat Seçiniz'
      }
    ]
    var dynamic_select = new DynamicSelect(parameters)
    dynamic_select.init()
  });
</script>
